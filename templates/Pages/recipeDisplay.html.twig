{% extends 'base.html.twig' %}

{% block title %}TastyTable{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('style/recipeDisplay.css') }}">
{% endblock %}

{% block body %}
    <main>
        <div class="container">
            <!-- Delete Button -->
            <form action="{{ path('recipe_delete', {'id': recipe.id}) }}" method="post" style="position: absolute; top: 10px; right: 10px;">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>

            <!-- Recipe Image -->
            <aside>
                <div class="image">
                    {% if recipe.picturePath %}
                        <img src="{{ asset('style/images/recipeImages/' ~ recipe.picturePath) }}" alt="Recipe Image" style="width: 280px; height: 280px;">
                    {% else %}
                        <img src="{{ asset('style/images/placeholderImage.jpeg') }}" alt="Recipe Image" style="width: 280px; height: 280px;">
                    {% endif %}
                </div>
                <!-- Servings calculator -->
                <div class="below-image">
                    <div class="servings">
                        <h2>Servings</h2>
                        <button id="decrease-servings" onclick="adjustServings(-1)"><i class="fas fa-minus"></i></button>
                        <span id="servings" data-initial="{{ recipe.servings }}">{{ recipe.servings }}</span>
                        <button id="increase-servings" onclick="adjustServings(1)"><i class="fas fa-plus"></i></button>
                    </div>
                    <!-- Ingredients -->
                    <div class="ingredients">
                        {% if recipe.ingredients is not empty %}
                            <h2>Ingredients:</h2>
                            <ul id="ingredients-list">
                                {% for index, ingredient in recipe.ingredients %}
                                    <li>
                                        {% if recipe.ingredientsAmounts[index] is not null %}
                                            <span class="ingredient-amount" data-original-amount="{{ recipe.ingredientsAmounts[index] }}">
                                                {{ recipe.ingredientsAmounts[index] }} {{ recipe.ingredientsUnits[index] }}
                                                {% if recipe.ingredientsUnits[index] is not empty %} of {% endif %}
                                            </span>
                                        {% endif %}
                                        {{ ingredient }}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>No ingredients found.</p>
                        {% endif %}
                    </div>
                    <!-- Comments Section -->
                    <div>
                        <h2>Comments</h2>

                    </div>
                </div>
            </aside>
            <!-- Recipe Info -->
            <div class="right-side">
                <div class="recipeInfo">
                    <h2>{{ recipe.recipeName }}</h2>
                    <p>{{ recipe.recipeDescription }}</p>
                    <p>Cooking Time: {{ recipe.time }} minutes &nbsp; | &nbsp; Calories: {{ recipe.calories }} kcal</p>
                    <p>Fats: {{ recipe.fat }}g &nbsp; | &nbsp; Carbs: {{ recipe.carbs }}g &nbsp; | &nbsp; Proteins: {{ recipe.protein }}g</p>
                    <p>Price range:
                        {% if recipe.cost == 1 %}
                            €
                        {% elseif recipe.cost == 2 %}
                            €€
                        {% elseif recipe.cost == 3 %}
                            €€€
                        {% endif %}
                        &nbsp; | &nbsp; Rating: ★★★★★
                    </p>
                </div>
                <!-- Instructions -->
                <div>
                    <h2>Instructions</h2>
                    {% if recipe.instructions is not empty %}
                        <div>
                            {% for step in recipe.instructions %}
                                <strong>Step {{ loop.index }}:</strong><br>{{ step }}<br><br>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>No instructions found.</p>
                    {% endif %}
                </div>
                <!-- Buttons to like recipe and mark as done -->
                <div>
                    <button onclick="likeRecipe()">Like</button>
                    <button onclick="markAsDone()">Mark as Done</button>
                </div>
            </div>
        </div>
    </main>
    <div id="footer"></div>
    <script>
        $(function(){
            $("#header").load("Header.html");
            $("#footer").load("Footer.html");
        });
        function adjustServings(change) {
            let servingsElement = document.getElementById('servings');
            let initialServings = parseFloat(servingsElement.getAttribute('data-initial'));
            let currentServings = parseFloat(servingsElement.innerText);
            let newServings = currentServings + change;
            if (newServings < 1) return; // Prevent servings from going below 1
            servingsElement.innerText = newServings;
            let ingredientElements = document.querySelectorAll('.ingredient-amount');
            ingredientElements.forEach(element => {
                let originalAmount = parseFloat(element.getAttribute('data-original-amount'));
                if (!isNaN(originalAmount)) { // Check if originalAmount is not NaN (i.e., it's a valid number)
                    let unit = element.innerText.split(' ')[1]; // Extract the unit
                    let newAmount = (originalAmount * newServings) / initialServings;
                    element.innerText = `${Math.round(newAmount)} ${unit}`; // Round to whole number
                    if (unit) {
                        element.innerText += " of "; // Add "of" if unit is present
                    }
                }
            });
        }
        function likeRecipe() {
            alert('Recipe liked!');
        }
        function markAsDone() {
            alert('Recipe marked as done!');
        }
    </script>
{% endblock %}
